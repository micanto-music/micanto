import{u as R,I as c,d as k,r as S,g as B,a as F,l as _,j as e,C as O,s as J,P as j,h as z,m as w}from"./index-561b5fb2.js";import{B as G}from"./BaseModal-a979b500.js";import{A}from"./react-select-async-creatable.esm-a1289c3e.js";import{E as H}from"./EditCoverDroppable-335a98e6.js";function X(u){var g,y,N,C;const[l]=R();let a=u.data;const h=a[0].cover?c(a,"cover")?a[0].cover:k:k,[b,M]=S.useState(h),V=B(t=>t.updateItems),{control:v,formState:{errors:f},register:d,handleSubmit:q}=F(),m=a.length===1,o=m?"":l("edit.leave"),[E,T]=S.useState({}),I=(t,i)=>{T(i)};let p=[];if(m)p=a[0].artists.map(t=>({value:t.name,label:t.name}));else{let t=[...new Set(a[0].artists.map(r=>r.name))],i=!1;for(let r=1;r<a.length;r++){let n=[...new Set(a[r].artists.map(x=>x.name))];if(i=_.isEqual(t,n),!i)break}i&&(p=a[0].artists.map(r=>({value:r.name,label:r.name})))}const s={title:c(a,"title")?a[0].title:"",album:c(a,"album")?a[0].album:"",track:c(a,"track")?a[0].track:"",disc:c(a,"disc")?a[0].disc:"",genre:c(a,"genre")?a[0].genre:"",explicit:c(a,"explicit")?a[0].explicit:"",year:c(a,"year")?a[0].year:""},L=async t=>{J();const i=new FormData;a.map(r=>{i.append("tracks[]",r.id)}),b&&b!==h&&(i.append("image",b),i.append("crop",JSON.stringify(E)));for(let r in t){let n=t[r];Array.isArray(n)?n.map(x=>{i.append(r+"[]",x)}):i.append(r,n)}i.set("album",t.album.value),j.updateTracks(i).then(r=>{V(r),z()}),u.onClose()};async function P(t){return j.searchArtists(t).then(i=>i.map(w))}async function $(t){return j.searchAlbum(t).then(i=>i.map(w))}return e.jsx(G,{title:l("context.edit_tracks"),show:u.isOpen,onClose:u.onClose,children:e.jsxs("form",{onSubmit:q(L),children:[e.jsx(H,{cover:h,setCover:M,saveCrop:I}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.title")}),e.jsx("input",{className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.title,...d("title",{required:{value:m,message:l("edit.required")}})}),((g=f.title)==null?void 0:g.message)&&e.jsx("div",{className:"validationText",children:(y=f.title)==null?void 0:y.message})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.artists")}),e.jsx(O,{control:v,defaultValue:p.map(t=>t.value),name:"artists",rules:{required:{value:m,message:l("edit.required")}},render:({field:{onChange:t,value:i,ref:r}})=>e.jsx(A,{className:"multi-select",classNamePrefix:"micanto-select",inputRef:r,placeholder:o,defaultValue:p.filter(n=>i.includes(n.value)),onChange:n=>t(n.map(x=>x.value)),noOptionsMessage:()=>l("select.noOptionsMessage"),formatCreateLabel:n=>`${l("select.create")} "${n}"`,loadingMessage:()=>l("select.loadingMessage"),loadOptions:P,options:p,isMulti:!0,cacheOptions:!0})}),((N=f.artists)==null?void 0:N.message)&&e.jsx("div",{className:"validationText",children:(C=f.artists)==null?void 0:C.message})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.album")}),e.jsx(O,{control:v,defaultValue:{value:s==null?void 0:s.album,label:s==null?void 0:s.album},name:"album",rules:{required:{value:m,message:l("edit.required")}},render:({field:{onChange:t,value:i,ref:r}})=>e.jsx(A,{className:"select",classNamePrefix:"micanto-select",inputRef:r,placeholder:o,defaultValue:{value:s==null?void 0:s.album,label:s==null?void 0:s.album},onChange:n=>t(n),noOptionsMessage:()=>l("select.noOptionsMessage"),loadingMessage:()=>l("select.loadingMessage"),formatCreateLabel:n=>`${l("select.create")} "${n}"`,loadOptions:$,cacheOptions:!0,isClearable:!0})})]}),e.jsx("div",{className:"form-field form-check",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",...d("compilation")})," ",l("edit.compilation")]})}),e.jsx("div",{className:"form-field form-check",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",defaultChecked:(s==null?void 0:s.explicit)==1,...d("explicit")})," ",l("edit.explicit")]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.track")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.track,...d("track")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.disc")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.disc,...d("disc")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.genre")}),e.jsx("input",{type:"text",className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.genre,...d("genre")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.year")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.year,...d("year")})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:u.onClose,type:"button",className:"btn btn-close mr-2","data-bs-dismiss":"modal","aria-label":"Close",children:l("close")}),e.jsx("button",{className:"btn btn-primary",type:"submit",children:l("save")})]})]})})}export{X as default};
