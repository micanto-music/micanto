import{u as T,i as O,a as A,k as P,r as g,j as e,s as U,P as k,h as B}from"./index-1190df7b.js";import{B as F}from"./BaseModal-dc632986.js";import{E as I}from"./EditCoverDroppable-47c7baca.js";function R(s){var f,p,w,x,h,j,v,b;const[a]=T(),{user:N,setUser:y}=O(),{formState:{errors:r},register:o,handleSubmit:C,watch:L}=A(),d=(f=s==null?void 0:s.data)!=null&&f.image?(p=s==null?void 0:s.data)==null?void 0:p.image:P,[m,S]=g.useState(d),i=s.data,[c,_]=g.useState({}),q=(t,l)=>{_(l)},E=async t=>{U();const l=new FormData;let u=!1;m&&m!==d&&(l.append("image",m),u=!0),c&&Object.hasOwn(c,"x")&&(l.append("crop",JSON.stringify(c)),u=!0),t.password&&l.append("password",t.password),l.append("name",t.name),l.append("email",t.email),t.new_password!=""&&l.append("new_password",t.new_password),k.updateUser(i==null?void 0:i.id,l).then(n=>{B(),y(n==null?void 0:n.data),u&&(document.querySelector(".profile-img").src=(n==null?void 0:n.data.image)+"?="+Date.now())}),s.onClose()};return e.jsx(F,{title:a("profile.title"),show:s.isOpen,onClose:s.onClose,children:e.jsxs("form",{onSubmit:C(E),encType:"multipart/form-data",children:[e.jsx(I,{cover:d,setCover:S,saveCrop:q}),N.is_admin!==1&&e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:a("profile.current_password")}),e.jsx("input",{type:"password",className:"w-full form-input",...o("password",{required:{value:!0,message:a("edit.required")}})}),((w=r.password)==null?void 0:w.message)&&e.jsx("div",{className:"validationText",children:(x=r.password)==null?void 0:x.message}),e.jsx("p",{children:a("profile.password_hint")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:a("profile.name")}),e.jsx("input",{type:"text",className:"w-full form-input",defaultValue:i==null?void 0:i.name,...o("name",{required:{value:!0,message:a("edit.required")}})}),((h=r.name)==null?void 0:h.message)&&e.jsx("div",{className:"validationText",children:(j=r.name)==null?void 0:j.message})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:a("profile.email")}),e.jsx("input",{type:"email",className:"w-full form-input",defaultValue:i==null?void 0:i.email,...o("email",{required:{value:!0,message:a("edit.required")}})}),((v=r.email)==null?void 0:v.message)&&e.jsx("div",{className:"validationText",children:(b=r.email)==null?void 0:b.message})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:a("profile.new_password")}),e.jsx("input",{type:"password",className:"w-full form-input",...o("new_password")})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:s.onClose,type:"button",className:"btn btn-close mr-2","data-bs-dismiss":"modal","aria-label":"Close",children:a("close")}),e.jsx("button",{className:"btn btn-primary",type:"submit",children:a("save")})]})]})})}export{R as default};
