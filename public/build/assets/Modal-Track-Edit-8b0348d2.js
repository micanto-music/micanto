import{u as I,I as d,d as k,r as L,g as P,a as $,l as R,j as e,C as w,s as B,P as j,h as F,m as M}from"./index-816a077d.js";import{B as _}from"./BaseModal-05f2c7a2.js";import{A as O}from"./react-select-async-creatable.esm-1287e58f.js";import{E as z}from"./EditCoverDroppable-6719ec2f.js";function Q(u){var v,y,N,C;const[l]=I();let a=u.data;const h=a[0].cover?d(a,"cover")?a[0].cover:k:k,[x,S]=L.useState(h),V=P(t=>t.updateItems),{control:g,formState:{errors:f},register:o,handleSubmit:A}=$(),m=a.length===1,c=m?"":l("edit.leave");let p=[];if(m)p=a[0].artists.map(t=>({value:t.name,label:t.name}));else{let t=[...new Set(a[0].artists.map(i=>i.name))],r=!1;for(let i=1;i<a.length;i++){let n=[...new Set(a[i].artists.map(b=>b.name))];if(r=R.isEqual(t,n),!r)break}r&&(p=a[0].artists.map(i=>({value:i.name,label:i.name})))}const s={title:d(a,"title")?a[0].title:"",album:d(a,"album")?a[0].album:"",track:d(a,"track")?a[0].track:"",disc:d(a,"disc")?a[0].disc:"",genre:d(a,"genre")?a[0].genre:"",year:d(a,"year")?a[0].year:""},q=async t=>{B();const r=new FormData;a.map(i=>{r.append("tracks[]",i.id)}),x&&x!==h&&r.append("image",x);for(let i in t){let n=t[i];Array.isArray(n)?n.map(b=>{r.append(i+"[]",b)}):r.append(i,n)}r.set("album",t.album.value),j.updateTracks(r).then(i=>{V(i),F()}),u.onClose()};async function E(t){return j.searchArtists(t).then(r=>r.map(M))}async function T(t){return j.searchAlbum(t).then(r=>r.map(M))}return e.jsx(_,{title:l("context.edit_tracks"),show:u.isOpen,onClose:u.onClose,children:e.jsxs("form",{onSubmit:A(q),children:[e.jsx(z,{cover:h,setCover:S}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.title")}),e.jsx("input",{className:"w-full form-input",placeholder:c,defaultValue:s==null?void 0:s.title,...o("title",{required:{value:m,message:l("edit.required")}})}),((v=f.title)==null?void 0:v.message)&&e.jsx("div",{className:"validationText",children:(y=f.title)==null?void 0:y.message})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.artists")}),e.jsx(w,{control:g,defaultValue:p.map(t=>t.value),name:"artists",rules:{required:{value:m,message:l("edit.required")}},render:({field:{onChange:t,value:r,ref:i}})=>e.jsx(O,{className:"multi-select",classNamePrefix:"micanto-select",inputRef:i,placeholder:c,defaultValue:p.filter(n=>r.includes(n.value)),onChange:n=>t(n.map(b=>b.value)),noOptionsMessage:()=>l("select.noOptionsMessage"),formatCreateLabel:n=>`${l("select.create")} "${n}"`,loadingMessage:()=>l("select.loadingMessage"),loadOptions:E,options:p,isMulti:!0,cacheOptions:!0})}),((N=f.artists)==null?void 0:N.message)&&e.jsx("div",{className:"validationText",children:(C=f.artists)==null?void 0:C.message})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.album")}),e.jsx(w,{control:g,defaultValue:{value:s==null?void 0:s.album,label:s==null?void 0:s.album},name:"album",rules:{required:{value:m,message:l("edit.required")}},render:({field:{onChange:t,value:r,ref:i}})=>e.jsx(O,{className:"select",classNamePrefix:"micanto-select",inputRef:i,placeholder:c,defaultValue:{value:s==null?void 0:s.album,label:s==null?void 0:s.album},onChange:n=>t(n),noOptionsMessage:()=>l("select.noOptionsMessage"),loadingMessage:()=>l("select.loadingMessage"),formatCreateLabel:n=>`${l("select.create")} "${n}"`,loadOptions:T,cacheOptions:!0,isClearable:!0})})]}),e.jsx("div",{className:"form-field form-check",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",...o("compilation")})," ",l("edit.compilation")]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.track")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:c,defaultValue:s==null?void 0:s.track,...o("track")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.disc")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:c,defaultValue:s==null?void 0:s.disc,...o("disc")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.genre")}),e.jsx("input",{type:"text",className:"w-full form-input",placeholder:c,defaultValue:s==null?void 0:s.genre,...o("genre")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.year")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:c,defaultValue:s==null?void 0:s.year,...o("year")})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:u.onClose,type:"button",className:"btn btn-close mr-2","data-bs-dismiss":"modal","aria-label":"Close",children:l("close")}),e.jsx("button",{className:"btn btn-primary",type:"submit",children:l("save")})]})]})})}export{Q as default};
