import{u as I,I as c,d as C,r as L,g as P,a as $,l as R,j as e,C as w,s as B,P as j,h as F,m as M}from"./index-00800051.js";import{B as _}from"./BaseModal-08c1bbb8.js";import{A as O}from"./react-select-async-creatable.esm-276cc995.js";import{E as z}from"./EditCoverDroppable-179d0a27.js";function Q(u){var g,y,N,k;const[l]=I();let a=u.data;const b=a[0].cover?c(a,"cover")?a[0].cover:C:C,[f,S]=L.useState(b),V=P(t=>t.updateItems),{control:v,formState:{errors:h},register:d,handleSubmit:A}=$(),m=a.length===1,o=m?"":l("edit.leave");let p=[];if(m)p=a[0].artists.map(t=>({value:t.name,label:t.name}));else{let t=[...new Set(a[0].artists.map(i=>i.name))],r=!1;for(let i=1;i<a.length;i++){let n=[...new Set(a[i].artists.map(x=>x.name))];if(r=R.isEqual(t,n),!r)break}r&&(p=a[0].artists.map(i=>({value:i.name,label:i.name})))}const s={title:c(a,"title")?a[0].title:"",album:c(a,"album")?a[0].album:"",track:c(a,"track")?a[0].track:"",disc:c(a,"disc")?a[0].disc:"",genre:c(a,"genre")?a[0].genre:"",explicit:c(a,"explicit")?a[0].explicit:"",year:c(a,"year")?a[0].year:""},q=async t=>{B();const r=new FormData;a.map(i=>{r.append("tracks[]",i.id)}),f&&f!==b&&r.append("image",f);for(let i in t){let n=t[i];Array.isArray(n)?n.map(x=>{r.append(i+"[]",x)}):r.append(i,n)}r.set("album",t.album.value),j.updateTracks(r).then(i=>{V(i),F()}),u.onClose()};async function E(t){return j.searchArtists(t).then(r=>r.map(M))}async function T(t){return j.searchAlbum(t).then(r=>r.map(M))}return e.jsx(_,{title:l("context.edit_tracks"),show:u.isOpen,onClose:u.onClose,children:e.jsxs("form",{onSubmit:A(q),children:[e.jsx(z,{cover:b,setCover:S}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.title")}),e.jsx("input",{className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.title,...d("title",{required:{value:m,message:l("edit.required")}})}),((g=h.title)==null?void 0:g.message)&&e.jsx("div",{className:"validationText",children:(y=h.title)==null?void 0:y.message})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.artists")}),e.jsx(w,{control:v,defaultValue:p.map(t=>t.value),name:"artists",rules:{required:{value:m,message:l("edit.required")}},render:({field:{onChange:t,value:r,ref:i}})=>e.jsx(O,{className:"multi-select",classNamePrefix:"micanto-select",inputRef:i,placeholder:o,defaultValue:p.filter(n=>r.includes(n.value)),onChange:n=>t(n.map(x=>x.value)),noOptionsMessage:()=>l("select.noOptionsMessage"),formatCreateLabel:n=>`${l("select.create")} "${n}"`,loadingMessage:()=>l("select.loadingMessage"),loadOptions:E,options:p,isMulti:!0,cacheOptions:!0})}),((N=h.artists)==null?void 0:N.message)&&e.jsx("div",{className:"validationText",children:(k=h.artists)==null?void 0:k.message})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.album")}),e.jsx(w,{control:v,defaultValue:{value:s==null?void 0:s.album,label:s==null?void 0:s.album},name:"album",rules:{required:{value:m,message:l("edit.required")}},render:({field:{onChange:t,value:r,ref:i}})=>e.jsx(O,{className:"select",classNamePrefix:"micanto-select",inputRef:i,placeholder:o,defaultValue:{value:s==null?void 0:s.album,label:s==null?void 0:s.album},onChange:n=>t(n),noOptionsMessage:()=>l("select.noOptionsMessage"),loadingMessage:()=>l("select.loadingMessage"),formatCreateLabel:n=>`${l("select.create")} "${n}"`,loadOptions:T,cacheOptions:!0,isClearable:!0})})]}),e.jsx("div",{className:"form-field form-check",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",...d("compilation")})," ",l("edit.compilation")]})}),e.jsx("div",{className:"form-field form-check",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",defaultChecked:(s==null?void 0:s.explicit)==1,...d("explicit")})," ",l("edit.explicit")]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.track")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.track,...d("track")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.disc")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.disc,...d("disc")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.genre")}),e.jsx("input",{type:"text",className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.genre,...d("genre")})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:l("edit.year")}),e.jsx("input",{type:"number",className:"w-full form-input",placeholder:o,defaultValue:s==null?void 0:s.year,...d("year")})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:u.onClose,type:"button",className:"btn btn-close mr-2","data-bs-dismiss":"modal","aria-label":"Close",children:l("close")}),e.jsx("button",{className:"btn btn-primary",type:"submit",children:l("save")})]})]})})}export{Q as default};
